# 캐시 메모리1

- [캐시 메모리1](#캐시-메모리1)
  - [캐시 메모리 정의](#캐시-메모리-정의)
  - [캐시 메모리 데이터 전송 단위](#캐시-메모리-데이터-전송-단위)
  - [캐시 메모리의 필요성](#캐시-메모리의-필요성)
  - [지역성](#지역성)
  - [캐시 메모리는 무엇으로 만드나요?](#캐시-메모리는-무엇으로-만드나요)
  - [슈퍼세트관계](#슈퍼세트관계)
  - [캐시메모리의 일관성을 유지하는 방법은 무엇인가요?](#캐시메모리의-일관성을-유지하는-방법은-무엇인가요)
  - [캐시라인](#캐시라인)


## 캐시 메모리 정의
- 캐시 메모리는 메인메모리에 있는 명령어와 데이터 중 일부를 가져와 임시적으로 저장하여 CPU에서 필요로 할 때 해당 정보의 신속한 제공이 가능하도록 만들어진 장치입니다.
- CPU와 주기억장치의 접근 속도 차이를 줄이기 위해 사용되는 고속 버퍼 메모리

## 캐시 메모리 데이터 전송 단위

|방식|CPU|캐시메모리|메인메모리|
|----|:---:|:---------:|:----------:|
|전송단위|워드|Load <- 임시, 버퍼 -> Store(Save)|블록|
|속도|1등|2등|3등|

메인메모리에서 캐시메모리로 데이터를 가져올때는 블록 단위로 가져옵니다. 그리고 캐시메모리에서 CPU로 데이터를 전송할 때는 워드 단위로 전송합니다.
 

## 캐시 메모리의 필요성

- CPU와 메인메모리 사이의 데이터 처리 속도 차이가 크기 때문에 높은 성능의 CPU를 제대로 활용하지 못하고 있습니다. 따라서 캐시 메모리를 사이에 두어 CPU와 메인메모리의 데이터 처리 속도 차이를 극복할 수 있습니다.


## 지역성
> 프로세스가 실행되는 동안 일부 페이지만 집중적으로 참조되는 현상

**참조의 지역성**이 무엇인가요?

- 일반적인 컴퓨터에서 CPU는 프로그램 실행시간의 90%는 해당 프로그램 공간의 10%에서만 실행됩니다. 따라서 이 10%에 해당 하는 데이터를 캐시메모리에 적재해두면, CPU의 데이터 처리 성능이 향상됩니다.

**Working Set**

- 프로세스가 효율적으로 실행되기 위해 프로세스에 의해 자주 참조되는 페이지들의 집합

  - 공간적 지역성(≒배열) : 참조된 주소와 인접한 주소의 내용이 다시 참조된다는 특성
  - 시간적 지역성(≒스택) : 한 번 참조된 주소의 내용은 곧 다음에 다시 참조된다는 특성 
 

## 캐시 메모리는 무엇으로 만드나요?

- CPU : SRAM
- 캐시 메모리 : SRAM
- 메인 메모리 : DRAM

## 슈퍼세트관계

슈퍼세트관계 : 최근의 고성능 컴퓨터는 캐시메모리가 두개 있습니다. 하나는 CPU내에 들어있는 캐시메모리로 아주 작지만 아주 빠르고, 다른 하나는 CPU외에 있는 캐시메모리로, 상대적으로 느리지만 용량은 더 큽니다.

- L1 : CPU내에 있는 캐시메모리
- L2 : CPU 외에 있는 캐시메모리
  - L1은 L2보다 속도는 빠르지만 적중률이 낮습니다.


## 캐시메모리의 일관성을 유지하는 방법은 무엇인가요?
- 각 프로세서별로 별도의 캐시 메모리를 가지고 있는 공유 메모리 멀티프로세서에서 캐시의 갱신으로 인한 주기억 장치(공유 메모리)와 캐시에 저장된 데이터가 불일치하는 문제가 발생

1. 공유 캐시메모리를 사용하는 방법입니다. 시스템에 있는 여러개의 프로세서가 하나의 공유 캐시메모리를 사용하면 데이터를 일관성있게 유지할 수 있습니다. 하지만 동시에 캐시메모리에 접근하면 **충돌**이 발생할 수 있습니다.

2. 공유변수를 캐시메모리에 저장하지 않는 방법입니다. 이는 수정 가능한 데이터를 캐시메모리 저장하지 않는 방법입니다. 이 방법은 메인메모리에서 데이터를 읽어와 수정할 경우, 캐시메모리에 저장하지 않고 바로 메인메모리에 저장하는 방법입니다.

3. 버스 감시 시스템을 이용하는 방법입니다. 데이터의 일관성 유지를 위해 감시 기능을 가진 장비를 시스템 버스에 추가설치하는 방법입니다. 이 방법은 버스의 통신량이 증가하게 됩니다.

4. 하드웨어적 방식의 캐시 일관성 유지
   - 디렉토리 기반(directory-based) 프로토콜
   - 스누핑(snooping) 프로토콜 
   - MESI 프로토콜
     - M : Modify (수정)
     - E : Exclusive (배타적 ; 한쪽 캐시M만 데이터를 독점)
     - S : Shared (공유 : 다른 캐시M에서도 똑같은 데이터를 가져간 상태)
     - I : Invalid (무효화)


## 캐시라인

캐시 라인 (cache line) : 캐시 라인(cache line)은 일정한 크기의 block 단위로 관리된다. 
- 일반적으로 32Byte ~ 256Byte 정도의 크기이다. 
- 한 바이트를 읽어도 캐시라인 단위로 메모리부터 읽어오며, 데이터를 메모리에 쓸 때 캐시라인 단위로 쓴다.